#lang r6rs
(import (rnrs io simple (6))
        (rnrs files (6))
        (rnrs lists (6))
        (rnrs base (6))
        (rnrs r5rs (6))
        (srfi :19))

;Función numeroRandom
;Esta función random tuma un xn y obtiene el xn+1 de la secuencia de números aleatorios.
(define numeroRandom
     (lambda (xn)
     (define a 1103515245)
     (define c 12345)
     (define m 2147483648)
          (remainder (+ (* a xn) c) m)
     )
)
;Cada vez que pedimos un random, debemos pasar como argumento el random anterior.
;Acá un ejemplo que permite generar una lista de números aleatorios.
;Parámetros:
;* "cantidadNumerosLista" indica el largo de la lista a generar.
;* "numeroActual" valor actual del random, se pasa en cada nivel de recursión de forma actualizada
;* "maximoLista" Los números generados van desde 0 hasta maximoLista-1
(define obtenerListaRandom
     (lambda (cantidadNumerosLista numeroActual maximoLista)
          (if (= 0 cantidadNumerosLista)
               ;do
               '()
          ;else
          (let ((xNvo (numeroRandom numeroActual)))
               (cons (remainder xNvo maximoLista)
                    (obtenerListaRandom (- cantidadNumerosLista 1) xNvo maximoLista)
                    )
               )
          )
     )
)

(define (seed valor)
     (car (obtenerListaRandom 1 valor 3))
)
;(seed (date-second (current-date))) = pseudoaleatoreo.
;(seed 1) = 0
;(seed 2) = 1
;(seed 4) = 2

;CONSTRUCTOR
(define log '() )

;FUNCION DE PERTENENCIA
(define (log? log)
     (if (list? log)
          ;do
          (if (or (= (length log) 0) (string?(car log)))
               ;do
               #t
          ;else
          #f
          )
     ;else
     #f
     )
)

;LLamadas: (separarEvaluaciones (list 1 4 3 5 7 1))
;         (adquirirPersonalidad (list 1 4 3 5 7 1))

;Chatbot.
;Dominio:
;    personalidad: Se ingresa un string que determina la personalidad que tenga el chatbot.
;    vocabulario: Se ingresa un string que determina el tipo de vocabulario que tenga el chatbot.
;    evaluaciones: Se ingresa una lista con las evaluaciones anteriores.
;Tipo 1: Coloquial de vocabulario Alto.
;Tipo 2: Coloquial de vocabulario Pobre.
;Tipo 3: Formal de vocabulario Alto.
;Tipo 4: Formal de vocabulario Pobre.
;Se devulve una lista en donde el primer elemento de esta es el tipo
;de chatbot, el resto equivalen a las evaluaciones que tenga el chatbot.

;CONSTRUCTOR
(define (chatBot personalidad anteriorListaChatbot)
     (define listaChatbot '())
     (cond
          ((eqv? personalidad "informal" ) (append listaChatbot '(0) (separarEvaluaciones anteriorListaChatbot)))
          ((eqv? personalidad "formal" ) (append listaChatbot '(1) (separarEvaluaciones anteriorListaChatbot)))
          )
)
;Llamada: (chatBot "informal" '())

;FUNCION DE PERTENENCIA
(define (chatBot? chatBot)
     (if (and (list? chatBot) (and (or (> (adquirirPersonalidad chatBot) 0) (= (adquirirPersonalidad chatBot) 0)) (< (adquirirPersonalidad chatBot) 2)))
          ;do
          #t
     ;else
     #f
          )
     )
;Llamada: (chatBot? '(2 3 4 5))

;SELECTORES
(define (separarEvaluaciones listaChatbot)
     (define listaEvaluacion '())
     (if (not (= (length listaChatbot) 0))
          ;do
          (append listaEvaluacion (cdr listaChatbot))
     ;else
     listaChatbot
          )
     )

(define (adquirirPersonalidad listaChatbot)
     (define personalidadChatbot '())
     (if (not (= (length listaChatbot) 0))
          ;do
          (append personalidadChatbot (car listaChatbot))
     ;else
     listaChatbot
          )
     )

(define (Hora&Fecha momentoActual listaHora&Fecha)
     (append listaHora&Fecha
     ;Fecha
          (list (string-append (number->string (date-day (current-date))) "/"
                         (number->string (date-month (current-date))) "/"
                         (number->string (date-year (current-date)))
                    )
               )
     ;Hora
          (list (string-append (number->string (date-hour (current-date))) ":"
                         (number->string (date-minute (current-date))) ":"
                         (number->string (date-second (current-date)))
                    )
               )
          )
     )
;Llamada: (Hora&Fecha current-date '())

(define (obtenerElemento posicionObjetivo lista)
     (cond
          ((or (< posicionObjetivo 0) (> posicionObjetivo (length lista))))
          ((> posicionObjetivo 0) (obtenerElemento (- posicionObjetivo 1) (cdr lista)))
          (else (car lista))
          )
)

(define (displayLog log)
     (display log)
)

;Se realiza la venta de homocinéticas de los siguientes vehículos:
;    Toyota Rav4
;    Renault Duster
;    Hyundai Tucson
;    Nissan Qashqai
;    Nissan Kicks
(define (sendMessage msg chatBot log seed)
     (append log (Hora&Fecha current-date '()) (list "Usuario: " msg "Chatbot: " "Bienvenido " msj ", estos son las marcas/modelos de los autos de las homocinéticas que disponemos : 1.-Toyota Rav4, 2.-Renault Duster, 3.-Hyundai Tucson, 4.-Nissan Qashqai, 5.-Nissan Kicks, elija una opción y la cantidad de homocinéticas que desea"))
)

(define (begingDialog chatBot log seed)
     (if (= (adquirirPersonalidad chatBot) 1) ;Personalidad: Formal.
          ;do
          (cond
               ((and (> (date-hour (current-date)) 6) (< (date-hour (current-date)) 12) ())
               ;do
               (append log (Hora&Fecha current-date '()) (list "Chatbot: " "Buenos Días, ¿Cúal es tu nombre?" "Nombre:"))
               )
               ((and (>= (date-hour (current-date)) 12) (< (date-hour (current-date)) 20))
               ;do
               (append log (Hora&Fecha current-date '()) (list "Chatbot: " "Buenas Tardes, ¿Cúal es tu nombre?" "Nombre:"))
               )
               ((>= (date-hour (current-date)) 20)
               ;do
               (append log  (Hora&Fecha current-date '()) (list "Chatbot: " "Buenas Noches, ¿Cúal es tu nombre?" "Nombre:"))
               )
               (else (append log (Hora&Fecha current-date '()) (list "Chatbot: " "Buenas, ¿Cómo te llamas?" "Nombre:")))
               )
          ;else Personalidad: Informal.
          (cond
               ((= seed 0) (append log (Hora&Fecha current-date '()) (list "Chatbot: " "¡Hola!, Cómo te llamai?" "Nombre:")))
               ((= seed 1) (append log (Hora&Fecha current-date '()) (list "Chatbot: " "¡Buena!, Cómo te llamas?" "Nombre:")))
               ((= seed 2) (append log (Hora&Fecha current-date '()) (list "Chatbot: " "¡Hola compa!, Cómo te llamai?" "Nombre:")))
               )
          )
     )
;Llamada: (define log1 (begingDialog cb1 log (seed 1)))

(define (endDialog chatBot log seed)
     (if (= (adquirirPersonalidad chatBot) 1)
          ;do
          (cond
               ((and (> (date-hour (current-date)) 6) (< (date-hour (current-date)) 12))
               ;do
               (append log (Hora&Fecha current-date '()) (list "Chatbot: " "Espero haberte sido de utilidad, que tengas un buen día" (adquirirNombre log)",¡Adiós!. ¡No olvides puntuar la aplicación!"))
               )
               ((and (>= (date-hour (current-date)) 12) (< (date-hour (current-date)) 20))
               ;do
               (append log (Hora&Fecha current-date '()) (list "Chatbot: " "Espero haberte sido de utilidad, que tengas una buena tarde" (adquirirNombre log)",¡Adiós!. ¡No olvides puntuar la aplicación!"))
               )
               ((>= (date-hour (current-date)) 20)
               ;do
               (append log (Hora&Fecha current-date '()) (list "Chatbot: " "Espero haberte sido de utilidad, que tengas un buena noche "(adquirirNombre log)",¡Adiós!. ¡No olvides puntuar la aplicación!"))
               )
               (else (append log (Hora&Fecha current-date '()) (list "Chatbot: " "Espero haberte sido de utilidad " (adquirirNombre log)", ¡Hasta luego!. ¡No olvides puntuar la aplicación!"))
                     )
               )
          ;else
          (cond
               ((= seed 0) (append log (Hora&Fecha current-date '()) (list "Chatbot: " "Chao" (adquirirNombre log)", ¡Nos vimoh!. ¡Acuérdate de puntuar la aplicación!")))
               ((= seed 1) (append log (Hora&Fecha current-date '()) (list "Chatbot: " "Espero haberte servido" (adquirirNombre log)", ¡Adiós!. ¡Acuérdate de puntuar la aplicación!")))
               ((= seed 2) (append log (Hora&Fecha current-date '()) (list "Chatbot: " "Dale compa, ¡Nos vemos" (adquirirNombre log)"!. ¡Acuérdate de puntuar la aplicación!")))
               )
          )
)
;Llamada: (define log1 (endDialog cb1 log (seed 1)))



;(define (rate chatbot score f log)
;)

(define (buscadorRepeticiones log palabraObjetivo numeroCreciente)
     (if (not (= (member palabraObjetivo log) 0))
          ;do
          (buscadorRepeticiones (cdr (member palabraObjetivo log)) palabraObjetivo (+ numeroCreciente 1))
     ;else
     numeroCreciente
     )
)
;Llamada: (buscadorRepeticiones log "" 0)

(define (adquirirNombre log)
     (car (cdr (member "Nombre:" log)))
)
;Llamada: (adquirirNombre log)

#|
(define log1 (sendMessage "Hola" chatbot log))
          (if msg del sendMessage = hola)
               (despuesSaludo msg = hola)
                    perfecto su orden de pollo esta lista.
                    log1 = pollo + perfecto su orden de pollo esta lista.
          (if msg del sendMessage = pollo)
               (fondoListo msg = pollo)
                    perfecto su orden de pollo esta lista.
                    log1 = pollo + perfecto su orden de pollo esta lista.
log1 = pollo perfecto su orden de pollo esta lista.

(define (sendMessage msg (chatbot 1 "")  asdasd)
     (chatbot 1 msg)
)

(define (chatbot personalidad  msg )
     (if "" ) hacer nada
)

(define (comprobar msg)
     (if msg del sendMessage = hola)
          (despuesSaludo msg = hola)
               perfecto su orden de pollo esta lista.
               log1 = pollo + perfecto su orden de pollo esta lista.
     (if msg del sendMessage = pollo)
          (fondoListo msg = pollo)
               perfecto su orden de pollo esta lista.
               log1 = pollo + perfecto su orden de pollo esta lista.
)
|#


#|
LLamada general:
     (define cb1 (chatBot "informal" '()))

     (define log1 (begingDialog cb1 log (seed 1)))

     (define log2 (endDialog cb1 log1 (seed 1)))

|#
